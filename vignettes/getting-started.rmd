---
title: "Getting Started with cogxwalkr"
output: rmarkdown::html_vignette
bibliography: references.bib
vignette: >
  %\VignetteIndexEntry{getting-started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo=FALSE, eval=TRUE, message=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
pkgload::load_all()
library(DT)
options(DT.options = list(pageLength = 10),
        rmarkdown.html_vignette.check_title = FALSE)
```

# Introduction

`cogxwalkr` is an R package designed to facilitate crosswalking—or translating effect estimates—between different cognitive outcome measures in studies of cognitive aging, exposures, and interventions. It enables researchers to compare results across studies that use different cognitive tests.

This package implements methods described in [@Ackley2025-methods]. The manuscript authors developed two methods to crosswalk estimated treatment effects of cognitive outcomes that are flexible, broadly applicable, work when only summary statistics are available, and do not rely on strong distributional assumptions. This method requires access to a dataset that includes both the cognitive measure you wish to crosswalk from and the cognitive measure you wish to crosswalk to.

The package was developed by Sarah Ackley and Jason Gantenberg. This vignette demonstrates how to use cogxwalkr in R.

# Installing

To install the package, you will first need to install and load the remotes package, which you can do from the R console:

To install the package:

```{r install}
install.packages("remotes")
remotes::install_github("jrgant/cogxwalkr")
```

## Installation Errors

You may get an error message that reads:

```
Using GitHub PAT from the git credential store.
Error: Failed to install 'remotes' from GitHub:
  HTTP error 401.
  Bad credentials
```

The most likely cause is that `remotes` detects a bad Github token in your credential store. Run `gitcreds::gitcreds_delete()`, select option `2` to remove the bad credential from the store, and rerun the `remotes::install_github()` command above.

Alternatively, you may get a similar error message that reads:

```
Using github PAT from envvar GITHUB_PAT. Use `gitcreds::gitcreds_set()` and unset GITHUB_PAT in .Renviron (or elsewhere) if you want to use the more secure git credential store instead.
Error: Failed to install 'cogxwalkr' from GitHub:
  HTTP error 401.
  Bad credentials
```

In this case, run `Sys.setenv(GITHUB_PAT = "")` and then rerun the `remotes::install_github()` command above.

# Motivation

As a motivating example, consider a study estimating the effect of APOE-ε4 carrier status on scores from the MMSE (Mini-Mental State Examination). If we wish to compare this effect to results from another study that used the MoCA (Montreal Cognitive Assessment), we need a conversion factor that allows us to convert a summary measure on the MMSE scale to the MoCA scale. `cogxwalkr` aids in estimating the conversion coefficient required to crosswalk from the MMSE to the MoCA under the following general assumptions regarding two cognitive measures [@Ackley2025-methods]:

- they measure the same underlying construct (_e.g._, executive function, global cognition, etc.)
- they are correlated only through their measurement of this common construct.

<style type="text/css">
  .figcaption {
    color: #3e3b3b;
    font-size: 0.8em;
  }
  .float {
    width: 50%;
    display: block;
    margin: 0 auto;
    margin-bottom: 1em;
  }
  .float img {
    display: block;
    margin: 0 auto;
  }
  
  pre {
    overflow-y: scroll;
    max-height: 300px;
  }
</style>

![Directed acyclic graph reflecting the assumptions required to crosswalk measure _A_ to measure _B_, both of which measure aspects of the underlying construct _U_.](dag.svg){#fig:dag-assumptions}

# Usage

To load the package:

```{r load}
library(cogxwalkr)
```

## Adjunct Data

These crosswalk methods require individual-level data from an adjunct study: a study where both cognitive measures are performed for each participant. In this package, the built-in `cogsim` dataset represents the adjunct study data. The adjunct data is simulated data based on the [Alzheimer’s Disease Neuroimaging Initiative](https://adni.loni.usc.edu) (ADNI). This dataset includes an MMSE score and MoCA score conditional on binary dementia status (0 for absent and 1 for present) for approximately 1500 study participants. Code used to fit and simulate these data can be found at [](github/jrgant/data-raw/cogsim.r).

```{r cogsim, echo=FALSE, eval=TRUE}
DT::datatable(cogsim, caption = "Simulated `cogsim` dataset available in the package.")
```

To view the example adjunct study, `cogsim`, we can type either of the following into the R console:

```{r view-data}
head(cogsim)
View(cogsim)
```

Additional information is available via `?cogsim`.

We implement two methods to obtain crosswalk slopes: 1) unconditional method and 2) conditional method. The unconditional method requires only data on both cognitive measures for each individual, whereas the conditional method requires additional data on a third binary variable, here dementia status.

## Unconditional Method

To obtain an estimate of the crosswalk slope using the unconditional method we can use the crosswalk function, which is the workhorse of the package:

```{r crosswalk-unconditional-noboot}
crosswalk(cog1 = "mmse", cog2 = "moca", data = cogsim, niter = 500)
```

This estimates a crosswalk slope from `cog1`, here the MMSE, to `cog2`, here the MoCA, using the built-in cogsim data as the adjunct data. `cog1` and `cog2` must be supplied as strings. `niter` gives the number of random splits used to obtain the crosswalk. The built-in `cogsim` dataset can be replaced with any other dataset containing the appropriate columns. Since this uses the adjunct data without any bootstrap resampling, no uncertainty on the crosswalked slope is presented.

```{r crosswalk-unconditional-boot}
crosswalk(cog1 = "mmse",
          cog2 = "moca",
          data = cogsim,
          niter = 500,
          control = list(nboot = 100, seed = 123))

crosswalk(cog1 = "mmse",
          cog2 = "moca",
          data = cogsim,
          niter = 500,
          control = list(nboot = 100, seed = 123456, ncores = 8))
```

### Unconditional Method Using Summary Statistics

The unconditional method can also be used based only on summary statistics. (In many cases, it may be more statistically efficient to do so, as the number of unconditional split iterations must be chosen with care.)

The summary statistics approach is accessible directly via the `est_cw_coef()` function.

```{r est-cw-coef}
# estimate slope using lm()
est_cw_coef(cog1 = "mmse", cog2 = "moca", data = cogsim, method = "lm")

# estimate slope using manual calculation
est_cw_coef(cog1 == "mmse", cog2 = "moca", data = cogsim, method = "manual")
```

However, we recommend using `crosswalk()` because other functions in `cogxwalkr` are built to act upon its output, not that of `est_cw_coef()`.

Omitting the `niter` argument when calling `crosswalk()` will result in the package using the "lm" method to estimate the crosswalk:

```{r crosswalk-sumstat}
crosswalk(cog1 = "mmse", cog2 = "moca", data = cogsim)
```

## Conditional Method

To use the conditional method, we must specify an additional binary variable on which to perform the conditional splits. The optional `condition_by` input declares this input and, when present, will elicit the conditional method. Note that `crosswalk()` will ignore `niter` if `condition_by` is specified.

```{r crosswalk-conditional}
crosswalk(cog1 = "mmse",
          cog2 = "moca",
          data = cogsim,
          condition_by = "dementia")
```

## Summary and Plotting Functions

### Summaries

`crosswalk()` outputs a list containing the results of the estimation procedure,^[These lists have the class `cogxwalkr`.] along with information about the specifications selected by the user. Similar to `glm()` and `lm()`, the `cogxwalkr` package comes with functions to help summarize results.^[Note that we set `niter` and `nboot` much too low here, for the sake of exposition and to reduce rendering time.]

```{r crosswalk-summaries, cache=TRUE}
#| eval: true
boot_settings <- list(nboot = 100, seed = 999, ncores = 1)

# summary statistics estimation
cws <- crosswalk(cog1 = "mmse",
                cog2 = "moca",
                data = cogsim,
                control = boot_settings)
summary(cws)


# unconditional split
cwu <- crosswalk(cog1 = "mmse",
                 cog2 = "moca",
                 data = cogsim,
                 niter = 500,
                 control = boot_settings)
summary(cwu)

# conditional split
cwc <- crosswalk(cog1 = "mmse",
                 cog2 = "moca",
                 data = cogsim,
                 condition_by = "dementia",
                 control = boot_settings)
summary(cwc)
```

The outputs of `summary()` can be stored as objects (lists). To view the raw form of such an object, use `print.AsIs()`.

See the documentation for `summary.cogxwalkr()` for information on options concerning the $\alpha$ level and method used to estimate bootstrapped confidence intervals.

### Plotting

In general, we leave plotting the output, results, etc., up to the user. The package does provide simple plot output to allow users to review interim results quickly.

We will use the `cwu` object we saved in the prior section as an example. This object contains the results of a crosswalk estimation that used the unconditional split method, along with bootstrapping to estimate 95% confidence intervals. The `cxsum` argument takes a summary output and overlays these confidence intervals.

```{r plot-cwu-boot, out.width="100%", fig.width=8, fig.height=4, dpi=300}
#| eval: true
plot(cwu, cxsum = summary(cwu))
```

Alternatively, if we used the summary statistics method (`cws` above), we will see something a bit different.^[Note that there is currently a bug in the plotting method for a crosswalk based on summary statistics. The x-axis label should omit the line referring to the "Intercept".] We no longer have a plot of the split differences.

```{r plot-cws-boot, out.width="50%", fig.width=4.2, fig.height=4, dpi=300, fig.align="center"}
#| eval: true
plot(cws)
```

Finally, if we conducted a splitting method without bootstrapping, we can suppress the bootstrap plot panel as follows. 

```{r plot-cw-no-boot, out.width="50%", fig.width=4, fig.height=4, dpi=300, fig.align="center"}
#| eval: true
cwu_noboot <- crosswalk(cog1 = "mmse", cog2 = "moca", data = cogsim, niter = 500)
plot(cwu_noboot, types = "slope")
```

As with, `summary.cogxwalkr()`, additional options for plotting are available in the documentation for `plot.cogxwalkr()`.

# References
